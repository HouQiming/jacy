import System.Console.*
import Javascript.*

class CNativeClass
	int n
	auto __JS_prototype(JSContext JS)
		ret=JS.New()
		/////////////////
		prop=JS.New()
		prop["get"]=function(JSContext JS){
			js_this=JS.GetThis();
			if !js_this:return 0
			native_this=js_this.as(CNativeClass)
			//Writeln('getter called ',!!native_this)
			if !native_this:return 0
			return JS.Return(native_this.n)
		}
		prop["set"]=function(JSContext JS){
			js_this=JS.GetThis();
			if !js_this:return 0
			native_this=js_this.as(CNativeClass)
			if !native_this:return 0
			native_this.n=JS.Param(0).as(int)
			return 0
		}
		JS.GetGlobal()["Object"]["defineProperty"].Call(JSObject,ret,"n",prop)
		return ret

(function(){
	JS=new JSContext
	///////////
	global=JS.GetGlobal()
	js_print=JS.eval(JSObject,"(function(c){print('js_print: ',c)})")
	js_print.Call(JSObject,js_print)
	js_print.Call(JSObject,["abc","456","789"])
	///////////
	native_obj=new CNativeClass
	native_obj.n=1234
	global["a"]=native_obj
	JS.debugEval("(function(){print('----------------');print('a.__proto__=',a.__proto__);print('a=',a);print('a.n=',a.n);a.n+=4444;})()","<eval>")
	Writeln('----------------')
	JS.debugEval("parse error","<eval>")
	Writeln('----------------')
	Writeln(native_obj.n)
})()
